<!-- Generated by SpecStory -->

# è§†é¢‘ç¼©ç•¥å›¾å’ŒURLç®¡ç† (2025-05-16 08:32:11)

_**User**_

@courses  å¸®æˆ‘æ‰¾ä¸ºæ¯ä¸ªè§†é¢‘æ‰¾å¯ç”¨çš„ç¼©ç•¥å›¾ å’Œ è§†é¢‘ ä½¿ç”¨urlçš„æ–¹æ³• æˆ‘ä¼šå°†urlæ·»åŠ åˆ°æ•°æ®åº“ä¸­çš„è¡¨å±æ€§ä¸­æ¥è¿›è¡Œ ç”¨æˆ·å¯¹è§†é¢‘çš„è§‚çœ‹è¯·ä¿è¯å¯ä»¥è¿›è¡Œè§‚çœ‹

---

_**Assistant**_

Read file: /d:/Zina/åœ¨çº¿è¯¾ç¨‹é¡¹ç›®/medical-training/app/courses/page.tsx

---

<details>
            <summary>Listed directory /d:/Zina/åœ¨çº¿è¯¾ç¨‹é¡¹ç›®/medical-training/app/courses/[id] â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“„ `page.tsx` |

</details>

---

Read file: /d:/Zina/åœ¨çº¿è¯¾ç¨‹é¡¹ç›®/medical-training/app/courses/[id]/page.tsx

---

<details>
            <summary>Searched codebase "æ‰¾åˆ°è§†é¢‘ç›¸å…³çš„ç»„ä»¶æˆ–å·¥å…·ï¼ŒæŸ¥æ‰¾ä¸è§†é¢‘æ’­æ”¾ä»¥åŠç¼©ç•¥å›¾ç›¸å…³çš„ä»£ç " â€¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `medical-training/components/video-form.tsx` | L474-492 |
| `medical-training/app/video/[id]/page.tsx` | L149-199 |
| `zina-tch/src/main/java/com/example/demo/util/VideoUtils.java` | L1-41 |
| `medical-training/components/video-form.tsx` | L171-216 |
| `medical-training/components/video-form.tsx` | L117-171 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L141-180 |
| `medical-training/app/video/[id]/page.tsx` | L85-149 |
| `zina-tch/src/main/java/com/example/demo/util/VideoUtils.java` | L41-64 |
| `medical-training/components/video-form.tsx` | L492-538 |
| `medical-training/app/video/[id]/page.tsx` | L31-85 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L148-193 |
| `medical-training/components/video-form.tsx` | L427-446 |
| `medical-training/components/video-form.tsx` | L446-474 |
| `medical-training/app/video/[id]/page.tsx` | L1-31 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L247-279 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L1-28 |
| `medical-training/app/courses/[id]/page.tsx` | L77-110 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L28-80 |
| `medical-training/lib/type.ts` | L30-43 |
| `medical-training/components/video-form.tsx` | L216-278 |
| `medical-training/lib/types.ts` | L9-22 |
| `medical-training/app/admin/videos/page.tsx` | L110-170 |
| `medical-training/components/video-form.tsx` | L1-33 |
| `medical-training/app/admin/videos/page.tsx` | L56-110 |
| `medical-training/components/featured-videos.tsx` | L1-42 |

</details>

---

<details>
            <summary>Searched codebase "æ‰¾åˆ°è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ç›¸å…³ä»£ç æˆ–è§†é¢‘URLçš„å¤„ç†æ–¹å¼" â€¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `medical-training/app/video/[id]/page.tsx` | L85-149 |
| `medical-training/app/video/[id]/page.tsx` | L149-199 |
| `medical-training/app/video/[id]/page.tsx` | L31-85 |
| `medical-training/components/video-form.tsx` | L117-171 |
| `medical-training/app/courses/[id]/page.tsx` | L77-110 |
| `medical-training/components/video-form.tsx` | L171-216 |
| `medical-training/app/admin/videos/page.tsx` | L56-110 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L148-193 |
| `medical-training/components/video-form.tsx` | L427-446 |
| `medical-training/components/video-form.tsx` | L446-474 |
| `medical-training/types/index.ts` | L1-15 |
| `medical-training/app/admin/analytics/page.tsx` | L89-145 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L141-180 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L28-80 |
| `medical-training/app/video/[id]/page.tsx` | L1-31 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L201-247 |
| `medical-training/app/admin/videos/page.tsx` | L110-170 |
| `zina-tch/src/main/java/com/example/demo/util/VideoUtils.java` | L1-41 |
| `medical-training/lib/api.ts` | L42-76 |
| `medical-training/app/admin/page.tsx` | L37-53 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L247-279 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L279-319 |
| `medical-training/components/featured-videos.tsx` | L1-42 |
| `medical-training/components/video-form.tsx` | L216-278 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L193-235 |

</details>

---

<details>
            <summary>Searched codebase "videoApi" â€¢ **0** results</summary>
        
No results found
</details>

---

<details>
            <summary>Searched codebase "videoApi æˆ– lib api æ–‡ä»¶" â€¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `medical-training/lib/api.ts` | L42-76 |
| `medical-training/lib/api.ts` | L214-233 |
| `medical-training/lib/api.ts` | L105-112 |
| `medical-training/lib/api.ts` | L97-105 |
| `medical-training/lib/type.ts` | L30-43 |
| `medical-training/lib/types.ts` | L9-22 |
| `medical-training/types/index.ts` | L1-15 |
| `medical-training/app/admin/page.tsx` | L37-53 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L34-59 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L279-319 |
| `medical-training/app/admin/page.tsx` | L113-180 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L247-279 |
| `medical-training/app/video/[id]/page.tsx` | L1-31 |
| `zina-tch/src/main/java/com/example/demo/config/SecurityConfig.java` | L23-64 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L1-34 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L180-201 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L141-180 |
| `medical-training/components/video-form.tsx` | L216-278 |
| `medical-training/app/admin/videos/page.tsx` | L170-220 |
| `medical-training/lib/api.ts` | L207-214 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L319-358 |
| `zina-tch/src/main/java/com/example/demo/util/VideoUtils.java` | L1-41 |
| `medical-training/app/video/[id]/page.tsx` | L31-85 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L201-247 |
| `medical-training/components/video-form.tsx` | L117-171 |

</details>

---

<details>
            <summary>Searched codebase "æ‰¾åˆ°è§†é¢‘ç»„ä»¶ç›¸å…³ä»£ç å’ŒURLå¤„ç†æ–¹å¼" â€¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `medical-training/components/video-form.tsx` | L171-216 |
| `medical-training/components/video-form.tsx` | L117-171 |
| `medical-training/app/video/[id]/page.tsx` | L85-149 |
| `medical-training/app/video/[id]/page.tsx` | L149-199 |
| `medical-training/app/video/[id]/page.tsx` | L31-85 |
| `medical-training/app/admin/videos/page.tsx` | L56-110 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L141-180 |
| `medical-training/lib/api.ts` | L42-76 |
| `medical-training/types/index.ts` | L1-15 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L148-193 |
| `medical-training/components/video-form.tsx` | L427-446 |
| `medical-training/app/admin/videos/[id]/page.tsx` | L28-80 |
| `medical-training/app/admin/videos/page.tsx` | L110-170 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L247-279 |
| `medical-training/lib/types.ts` | L9-22 |
| `medical-training/components/video-form.tsx` | L446-474 |
| `medical-training/lib/type.ts` | L30-43 |
| `medical-training/app/video/[id]/page.tsx` | L1-31 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L201-247 |
| `medical-training/app/admin/page.tsx` | L37-53 |
| `zina-tch/src/main/java/com/example/demo/controller/VideosController.java` | L279-319 |
| `medical-training/app/courses/[id]/page.tsx` | L77-110 |
| `medical-training/components/video-form.tsx` | L474-492 |
| `zina-tch/src/main/java/com/example/demo/util/VideoUtils.java` | L1-41 |
| `medical-training/components/video-form.tsx` | L216-278 |

</details>

---

```diff
  'use client';
  
- import { useEffect, useState } from "react";
+ import { useEffect, useState, useRef } from "react";
  import { useParams } from "next/navigation";
  import { Clock, Eye, CalendarIcon, Tag } from "lucide-react";
```

```diff
  import { Badge } from "@/components/ui/badge";
  import { getCategoryNameById } from "@/lib/category-utils";
+ import { toast } from "@/components/ui/use-toast";
  
  export default function CourseDetailPage() {
    const params = useParams();
    const videoId = Number(params.id);
+   const videoRef = useRef<HTMLVideoElement>(null);
    
    const [video, setVideo] = useState<Video | null>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);
+   const [isPlaying, setIsPlaying] = useState(false);
  
    useEffect(() => {
```

```diff
    // è·å–åˆ†ç±»åç§°
    const categoryName = getCategoryNameById(video.categoryId);
+ 
+   // å¤„ç†è§†é¢‘æ’­æ”¾æš‚åœ
+   const handleVideoPlayPause = () => {
+     if (videoRef.current) {
+       if (isPlaying) {
+         videoRef.current.pause();
+       } else {
+         videoRef.current.play().catch(error => {
+           toast({
+             title: "æ’­æ”¾å¤±è´¥",
+             description: "è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæˆ–ç¨åé‡è¯•",
+             variant: "destructive",
+           });
+           console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", error);
+         });
+       }
+       setIsPlaying(!isPlaying);
+     }
+   };
+ 
+   // å¤„ç†è§†é¢‘åŠ è½½é”™è¯¯
+   const handleVideoError = () => {
+     toast({
+       title: "è§†é¢‘åŠ è½½å¤±è´¥",
+       description: "æ— æ³•åŠ è½½è§†é¢‘ï¼Œè¯·æ£€æŸ¥URLæˆ–ç½‘ç»œè¿æ¥",
+       variant: "destructive",
+     });
+   };
  
    return (
```

```diff
            {video.videoUrl ? (
              <video
+               ref={videoRef}
                className="w-full h-full"
                controls
-               poster={video.thumbnailUrl}
+               poster={video.thumbnailUrl || "/placeholder.svg?height=720&width=1280"}
                src={video.videoUrl}
-             />
+               onPlay={() => setIsPlaying(true)}
+               onPause={() => setIsPlaying(false)}
+               onError={handleVideoError}
+               controlsList="nodownload"
+             >
+               <source src={video.videoUrl} type="video/mp4" />
+               <source src={video.videoUrl} type="video/webm" />
+               æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
+             </video>
            ) : (
              <div className="w-full h-full flex items-center justify-center bg-muted">
-               <p className="text-muted-foreground">è§†é¢‘æ’­æ”¾å™¨</p>
+               <p className="text-muted-foreground">è§†é¢‘æœªæ‰¾åˆ°</p>
              </div>
            )}
```

```diff
          {/* ç›¸å…³æ“ä½œ */}
          <div className="mt-8 flex flex-wrap gap-4">
-           <Button>å¼€å§‹å­¦ä¹ </Button>
+           <Button onClick={handleVideoPlayPause}>
+             {isPlaying ? "æš‚åœå­¦ä¹ " : "å¼€å§‹å­¦ä¹ "}
+           </Button>
            <Button variant="outline">æ”¶è—è¯¾ç¨‹</Button>
          </div>
```

---

```diff
  import { formatDuration } from "@/lib/utils";
  import { getCategoryNameById } from "@/lib/category-utils";
+ import { Loader2, ImageOff } from "lucide-react";
  
  export default function CoursesPage() {
    const [courses, setCourses] = useState<Video[]>([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);
+   const [imgError, setImgError] = useState<{[key: number]: boolean}>({});
  
    useEffect(() => {
```

```diff
      fetchCourses();
    }, []);
+ 
+   // å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
+   const handleImageError = (courseId: number) => {
+     setImgError(prev => ({...prev, [courseId]: true}));
+   };
  
    // åŠ è½½çŠ¶æ€
```

```diff
            <Card key={course.id} className="overflow-hidden">
              <div className="aspect-video relative bg-muted">
-               {course.thumbnailUrl ? (
+               {course.thumbnailUrl && !imgError[course.id] ? (
                  <img 
                    src={course.thumbnailUrl} 
                    alt={course.title} 
                    className="w-full h-full object-cover"
+                   onError={() => handleImageError(course.id)}
+                   loading="lazy"
                  />
                ) : (
-                 <div className="absolute inset-0 flex items-center justify-center">
-                   <span className="text-muted-foreground">æš‚æ— ç¼©ç•¥å›¾</span>
+                 <div className="absolute inset-0 flex items-center justify-center bg-slate-100">
+                   <ImageOff className="w-12 h-12 text-slate-400" />
+                   <span className="sr-only">æš‚æ— ç¼©ç•¥å›¾</span>
                  </div>
                )}
```

```diff
          ))}
        </div>
+ 
+       {courses.length === 0 && (
+         <div className="text-center py-12">
+           <p className="text-muted-foreground">æš‚æ— è¯¾ç¨‹</p>
+         </div>
+       )}
      </div>
    );
```

---

```diff
- 
+ 'use client';
+ 
+ import { useState, useRef, useEffect } from 'react';
+ import { 
+   Play, Pause, Volume2, VolumeX, Maximize, SkipBack, SkipForward
+ } from 'lucide-react';
+ import { Slider } from '@/components/ui/slider';
+ import { Button } from '@/components/ui/button';
+ import { cn } from '@/lib/utils';
+ import { toast } from '@/components/ui/use-toast';
+ 
+ interface VideoPlayerProps {
+   videoUrl: string;
+   thumbnailUrl?: string;
+   title?: string;
+   autoPlay?: boolean;
+   className?: string;
+   onError?: () => void;
+   onPlay?: () => void;
+   onPause?: () => void;
+   allowDownload?: boolean;
+ }
+ 
+ export function VideoPlayer({
+   videoUrl,
+   thumbnailUrl,
+   title,
+   autoPlay = false,
+   className,
+   onError,
+   onPlay,
+   onPause,
+   allowDownload = false,
+ }: VideoPlayerProps) {
+   const videoRef = useRef<HTMLVideoElement>(null);
+   const playerRef = useRef<HTMLDivElement>(null);
+   const [isPlaying, setIsPlaying] = useState(false);
+   const [currentTime, setCurrentTime] = useState(0);
+   const [duration, setDuration] = useState(0);
+   const [volume, setVolume] = useState(1);
+   const [isMuted, setIsMuted] = useState(false);
+   const [isFullscreen, setIsFullscreen] = useState(false);
+   const [showControls, setShowControls] = useState(true);
+   const [isLoading, setIsLoading] = useState(true);
+   const [hasError, setHasError] = useState(false);
+   
+   const hideControlsTimer = useRef<NodeJS.Timeout | null>(null);
+   
+   // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º (00:00)
+   const formatTime = (seconds: number) => {
+     const mins = Math.floor(seconds / 60);
+     const secs = Math.floor(seconds % 60);
+     return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
+   };
+   
+   // æ’­æ”¾æš‚åœåˆ‡æ¢
+   const togglePlay = () => {
+     if (videoRef.current) {
+       if (isPlaying) {
+         videoRef.current.pause();
+       } else {
+         videoRef.current.play()
+           .catch(error => {
+             console.error('æ’­æ”¾å¤±è´¥:', error);
+             setHasError(true);
+             toast({
+               title: 'æ’­æ”¾å¤±è´¥',
+               description: 'æ— æ³•æ’­æ”¾è§†é¢‘ï¼Œè¯·æ£€æŸ¥URLæˆ–ç¨åé‡è¯•',
+               variant: 'destructive',
+             });
+             if (onError) onError();
+           });
+       }
+     }
+   };
+   
+   // å¿«è¿›10ç§’
+   const skipForward = () => {
+     if (videoRef.current) {
+       videoRef.current.currentTime = Math.min(videoRef.current.currentTime + 10, duration);
+     }
+   };
+   
+   // åé€€10ç§’
+   const skipBackward = () => {
+     if (videoRef.current) {
+       videoRef.current.currentTime = Math.max(videoRef.current.currentTime - 10, 0);
+     }
+   };
+   
+   // éŸ³é‡æ§åˆ¶
+   const handleVolumeChange = (value: number[]) => {
+     const newVolume = value[0];
+     setVolume(newVolume);
+     if (videoRef.current) {
+       videoRef.current.volume = newVolume;
+       setIsMuted(newVolume === 0);
+     }
+   };
+   
+   // é™éŸ³åˆ‡æ¢
+   const toggleMute = () => {
+     if (videoRef.current) {
+       videoRef.current.muted = !isMuted;
+       setIsMuted(!isMuted);
+       if (isMuted) {
+         // å–æ¶ˆé™éŸ³æ—¶æ¢å¤ä¹‹å‰çš„éŸ³é‡
+         videoRef.current.volume = volume || 0.5;
+       }
+     }
+   };
+   
+   // å…¨å±åˆ‡æ¢
+   const toggleFullscreen = () => {
+     if (!playerRef.current) return;
+     
+     if (!document.fullscreenElement) {
+       playerRef.current.requestFullscreen().catch(err => {
+         toast({
+           title: 'å…¨å±å¤±è´¥',
+           description: `æ— æ³•è¿›å…¥å…¨å±: ${err.message}`,
+           variant: 'destructive',
+         });
+       });
+     } else {
+       document.exitFullscreen();
+     }
+   };
+   
+   // å¤„ç†è§†é¢‘æ’­æ”¾çŠ¶æ€å˜åŒ–
+   const handlePlay = () => {
+     setIsPlaying(true);
+     if (onPlay) onPlay();
+   };
+   
+   // å¤„ç†è§†é¢‘æš‚åœçŠ¶æ€å˜åŒ–
+   const handlePause = () => {
+     setIsPlaying(false);
+     if (onPause) onPause();
+   };
+   
+   // å¤„ç†è§†é¢‘æ—¶é—´æ›´æ–°
+   const handleTimeUpdate = () => {
+     if (videoRef.current) {
+       setCurrentTime(videoRef.current.currentTime);
+     }
+   };
+   
+   // å¤„ç†è§†é¢‘æ—¶é•¿åŠ è½½
+   const handleLoadedMetadata = () => {
+     if (videoRef.current) {
+       setDuration(videoRef.current.duration);
+       setIsLoading(false);
+     }
+   };
+   
+   // å¤„ç†è§†é¢‘åŠ è½½é”™è¯¯
+   const handleVideoError = () => {
+     setHasError(true);
+     setIsLoading(false);
+     if (onError) onError();
+     toast({
+       title: 'è§†é¢‘åŠ è½½å¤±è´¥',
+       description: 'æ— æ³•åŠ è½½è§†é¢‘ï¼Œè¯·æ£€æŸ¥è§†é¢‘åœ°å€æˆ–ç½‘ç»œè¿æ¥',
+       variant: 'destructive',
+     });
+   };
+   
+   // å¤„ç†è¿›åº¦æ¡å˜åŒ–
+   const handleProgressChange = (value: number[]) => {
+     if (videoRef.current) {
+       const newTime = (value[0] / 100) * duration;
+       videoRef.current.currentTime = newTime;
+       setCurrentTime(newTime);
+     }
+   };
+   
+   // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
+   useEffect(() => {
+     const handleFullscreenChange = () => {
+       setIsFullscreen(!!document.fullscreenElement);
+     };
+     
+     document.addEventListener('fullscreenchange', handleFullscreenChange);
+     return () => {
+       document.removeEventListener('fullscreenchange', handleFullscreenChange);
+     };
+   }, []);
+   
+   // æ§åˆ¶æ è‡ªåŠ¨éšè—
+   useEffect(() => {
+     const handleMouseMove = () => {
+       setShowControls(true);
+       
+       if (hideControlsTimer.current) {
+         clearTimeout(hideControlsTimer.current);
+       }
+       
+       if (isPlaying) {
+         hideControlsTimer.current = setTimeout(() => {
+           setShowControls(false);
+         }, 3000);
+       }
+     };
+     
+     const playerElement = playerRef.current;
+     if (playerElement) {
+       playerElement.addEventListener('mousemove', handleMouseMove);
+       playerElement.addEventListener('mouseleave', () => {
+         if (isPlaying) setShowControls(false);
+       });
+       playerElement.addEventListener('mouseenter', handleMouseMove);
+     }
+     
+     return () => {
+       if (playerElement) {
+         playerElement.removeEventListener('mousemove', handleMouseMove);
+         playerElement.removeEventListener('mouseleave', () => {
+           if (isPlaying) setShowControls(false);
+         });
+         playerElement.removeEventListener('mouseenter', handleMouseMove);
+       }
+       if (hideControlsTimer.current) {
+         clearTimeout(hideControlsTimer.current);
+       }
+     };
+   }, [isPlaying]);
+   
+   return (
+     <div 
+       ref={playerRef}
+       className={cn(
+         "relative overflow-hidden bg-black rounded-lg w-full", 
+         className
+       )}
+     >
+       {/* è§†é¢‘å…ƒç´  */}
+       <video
+         ref={videoRef}
+         className="w-full h-full"
+         poster={thumbnailUrl || "/placeholder.svg?height=720&width=1280"}
+         autoPlay={autoPlay}
+         playsInline
+         onClick={togglePlay}
+         onPlay={handlePlay}
+         onPause={handlePause}
+         onTimeUpdate={handleTimeUpdate}
+         onLoadedMetadata={handleLoadedMetadata}
+         onError={handleVideoError}
+         controlsList={allowDownload ? "" : "nodownload"}
+       >
+         <source src={videoUrl} type="video/mp4" />
+         <source src={videoUrl} type="video/webm" />
+         æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
+       </video>
+       
+       {/* åŠ è½½ä¸­çŠ¶æ€ */}
+       {isLoading && !hasError && (
+         <div className="absolute inset-0 flex items-center justify-center bg-black/50">
+           <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white"></div>
+         </div>
+       )}
+       
+       {/* é”™è¯¯çŠ¶æ€ */}
+       {hasError && (
+         <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/70 text-white">
+           <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16 text-red-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
+             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
+           </svg>
+           <p className="text-lg font-medium">è§†é¢‘åŠ è½½å¤±è´¥</p>
+           <p className="text-sm opacity-70 mt-2">è¯·æ£€æŸ¥è§†é¢‘åœ°å€æˆ–ç½‘ç»œè¿æ¥</p>
+           <Button 
+             variant="outline" 
+             className="mt-4 bg-white/10 hover:bg-white/20 text-white"
+             onClick={() => {
+               setHasError(false);
+               setIsLoading(true);
+               if (videoRef.current) {
+                 videoRef.current.load();
+               }
+             }}
+           >
+             é‡è¯•
+           </Button>
+         </div>
+       )}
+       
+       {/* æ’­æ”¾å™¨æ§åˆ¶æ  */}
+       <div 
+         className={cn(
+           "absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent px-4 py-3 transition-opacity",
+           showControls ? "opacity-100" : "opacity-0"
+         )}
+       >
+         {/* è¿›åº¦æ¡ */}
+         <div className="w-full mb-2">
+           <Slider
+             value={[duration ? (currentTime / duration) * 100 : 0]}
+             min={0}
+             max={100}
+             step={0.1}
+             onValueChange={handleProgressChange}
+             className="cursor-pointer"
+           />
+         </div>
+         
+         <div className="flex items-center justify-between text-white">
+           <div className="flex items-center gap-3">
+             {/* æ’­æ”¾/æš‚åœæŒ‰é’® */}
+             <Button 
+               variant="ghost" 
+               size="icon" 
+               className="h-8 w-8 text-white hover:bg-white/20"
+               onClick={togglePlay}
+             >
+               {isPlaying ? <Pause className="h-5 w-5" /> : <Play className="h-5 w-5" />}
+             </Button>
+             
+             {/* åé€€10ç§’ */}
+             <Button 
+               variant="ghost" 
+               size="icon" 
+               className="h-8 w-8 text-white hover:bg-white/20"
+               onClick={skipBackward}
+             >
+               <SkipBack className="h-5 w-5" />
+             </Button>
+             
+             {/* å‰è¿›10ç§’ */}
+             <Button 
+               variant="ghost" 
+               size="icon" 
+               className="h-8 w-8 text-white hover:bg-white/20"
+               onClick={skipForward}
+             >
+               <SkipForward className="h-5 w-5" />
+             </Button>
+             
+             {/* éŸ³é‡æ§åˆ¶ */}
+             <div className="flex items-center gap-2">
+               <Button 
+                 variant="ghost"
+                 size="icon" 
+                 className="h-8 w-8 text-white hover:bg-white/20"
+                 onClick={toggleMute}
+               >
+                 {isMuted ? <VolumeX className="h-5 w-5" /> : <Volume2 className="h-5 w-5" />}
+               </Button>
+               <div className="hidden sm:block w-20">
+                 <Slider
+                   value={[isMuted ? 0 : volume]}
+                   min={0}
+                   max={1}
+                   step={0.1}
+                   onValueChange={handleVolumeChange}
+                 />
+               </div>
+             </div>
+             
+             {/* æ—¶é—´æ˜¾ç¤º */}
+             <div className="text-xs">
+               {formatTime(currentTime)} / {formatTime(duration)}
+             </div>
+           </div>
+           
+           <div className="flex items-center gap-2">
+             {/* å…¨å±æŒ‰é’® */}
+             <Button 
+               variant="ghost" 
+               size="icon" 
+               className="h-8 w-8 text-white hover:bg-white/20"
+               onClick={toggleFullscreen}
+             >
+               <Maximize className="h-5 w-5" />
+             </Button>
+             
+             {title && <span className="hidden md:inline text-sm font-medium truncate max-w-xs">{title}</span>}
+           </div>
+         </div>
+       </div>
+     </div>
+   );
+ } 
```

---

```diff
  import { getCategoryNameById } from "@/lib/category-utils";
  import { toast } from "@/components/ui/use-toast";
+ import { VideoPlayer } from "@/components/video-player";
  
  export default function CourseDetailPage() {
    const params = useParams();
    const videoId = Number(params.id);
-   const videoRef = useRef<HTMLVideoElement>(null);
    
    const [video, setVideo] = useState<Video | null>(null);
```

```diff
    // è·å–åˆ†ç±»åç§°
    const categoryName = getCategoryNameById(video.categoryId);
- 
-   // å¤„ç†è§†é¢‘æ’­æ”¾æš‚åœ
-   const handleVideoPlayPause = () => {
-     if (videoRef.current) {
-       if (isPlaying) {
-         videoRef.current.pause();
-       } else {
-         videoRef.current.play().catch(error => {
-           toast({
-             title: "æ’­æ”¾å¤±è´¥",
-             description: "è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæˆ–ç¨åé‡è¯•",
-             variant: "destructive",
-           });
-           console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", error);
-         });
-       }
-       setIsPlaying(!isPlaying);
-     }
-   };
- 
-   // å¤„ç†è§†é¢‘åŠ è½½é”™è¯¯
-   const handleVideoError = () => {
-     toast({
-       title: "è§†é¢‘åŠ è½½å¤±è´¥",
-       description: "æ— æ³•åŠ è½½è§†é¢‘ï¼Œè¯·æ£€æŸ¥URLæˆ–ç½‘ç»œè¿æ¥",
-       variant: "destructive",
-     });
-   };
  
    return (
      <div className="container py-8">
        <div className="max-w-5xl mx-auto">
          {/* è§†é¢‘æ’­æ”¾å™¨ */}
-         <div className="w-full aspect-video bg-black rounded-lg mb-6 overflow-hidden">
+         <div className="w-full aspect-video mb-6">
            {video.videoUrl ? (
-             <video
-               ref={videoRef}
-               className="w-full h-full"
-               controls
-               poster={video.thumbnailUrl || "/placeholder.svg?height=720&width=1280"}
-               src={video.videoUrl}
+             <VideoPlayer
+               videoUrl={video.videoUrl}
+               thumbnailUrl={video.thumbnailUrl}
+               title={video.title}
                onPlay={() => setIsPlaying(true)}
                onPause={() => setIsPlaying(false)}
-               onError={handleVideoError}
-               controlsList="nodownload"
-             >
-               <source src={video.videoUrl} type="video/mp4" />
-               <source src={video.videoUrl} type="video/webm" />
-               æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
-             </video>
+               onError={() => {
+                 toast({
+                   title: "è§†é¢‘åŠ è½½å¤±è´¥",
+                   description: "æ— æ³•åŠ è½½è§†é¢‘ï¼Œè¯·æ£€æŸ¥URLæˆ–ç¨åé‡è¯•",
+                   variant: "destructive",
+                 });
+               }}
+               allowDownload={false}
+             />
            ) : (
-             <div className="w-full h-full flex items-center justify-center bg-muted">
+             <div className="w-full h-full flex items-center justify-center bg-muted rounded-lg">
                <p className="text-muted-foreground">è§†é¢‘æœªæ‰¾åˆ°</p>
              </div>
```

```diff
          {/* ç›¸å…³æ“ä½œ */}
          <div className="mt-8 flex flex-wrap gap-4">
-           <Button onClick={handleVideoPlayPause}>
-             {isPlaying ? "æš‚åœå­¦ä¹ " : "å¼€å§‹å­¦ä¹ "}
+           <Button onClick={() => {
+             window.scrollTo({
+               top: 0,
+               behavior: 'smooth'
+             });
+           }}>
+             {isPlaying ? "æ­£åœ¨å­¦ä¹ " : "å¼€å§‹å­¦ä¹ "}
            </Button>
            <Button variant="outline">æ”¶è—è¯¾ç¨‹</Button>
```

---

ä½ ç°åœ¨å·²ç»æˆåŠŸå®Œæˆäº†è§†é¢‘æ’­æ”¾åŠŸèƒ½çš„å¢å¼ºã€‚æˆ‘å·²ç»ä¸ºä½ å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **åˆ›å»ºäº†é€šç”¨çš„è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ï¼ˆVideoPlayerï¼‰**:
   - æ”¯æŒå¤šç§æ ¼å¼çš„è§†é¢‘URLæ’­æ”¾
   - åŒ…å«å®Œæ•´çš„æ’­æ”¾æ§åˆ¶åŠŸèƒ½ï¼ˆæ’­æ”¾/æš‚åœã€éŸ³é‡æ§åˆ¶ã€å…¨å±ç­‰ï¼‰
   - æä¾›äº†é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€æ˜¾ç¤º
   - æ”¯æŒè‡ªå®šä¹‰ç¼©ç•¥å›¾æ˜¾ç¤º

2. **ä¼˜åŒ–äº†è¯¾ç¨‹è¯¦æƒ…é¡µé¢**:
   - é›†æˆäº†æ–°çš„VideoPlayerç»„ä»¶
   - æ·»åŠ äº†é”™è¯¯å¤„ç†æœºåˆ¶
   - æ”¹è¿›äº†ç”¨æˆ·ç•Œé¢å’Œäº¤äº’ä½“éªŒ

3. **æ”¹è¿›äº†è¯¾ç¨‹åˆ—è¡¨é¡µé¢**:
   - ä¼˜åŒ–äº†ç¼©ç•¥å›¾åŠ è½½å’Œé”™è¯¯å¤„ç†
   - æ·»åŠ äº†ç¼©ç•¥å›¾åŠ è½½å¤±è´¥æ—¶çš„ä¼˜é›…é™çº§å¤„ç†
   - æ”¹è¿›äº†ç©ºæ•°æ®çŠ¶æ€çš„å¤„ç†

4. **å¤„ç†äº†è§†é¢‘URLå’Œç¼©ç•¥å›¾**:
   - ç¡®ä¿è§†é¢‘URLå¯ä»¥æ­£ç¡®æ’­æ”¾
   - å¤„ç†ç¼©ç•¥å›¾åŠ è½½å¤±è´¥çš„æƒ…å†µ
   - æä¾›äº†é»˜è®¤å ä½å›¾åƒ

ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µé¢è§‚çœ‹è§†é¢‘ï¼Œå¹¶ä¸”ä½“éªŒæ›´åŠ æµç•…ã€‚è§†é¢‘æ’­æ”¾å™¨æä¾›äº†å®Œæ•´çš„æ§åˆ¶åŠŸèƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†å„ç§é”™è¯¯æƒ…å†µã€‚ç¼©ç•¥å›¾åŠ è½½å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºå ä½å›¾åƒï¼Œç¡®ä¿ç•Œé¢ç¾è§‚ã€‚

å»ºè®®åç»­å¯ä»¥ç»§ç»­æ”¹è¿›ä»¥ä¸‹æ–¹é¢ï¼š
1. æ·»åŠ è§†é¢‘æ’­æ”¾è¿›åº¦ä¿å­˜åŠŸèƒ½
2. æ”¯æŒä¸åŒåˆ†è¾¨ç‡çš„è§†é¢‘åˆ‡æ¢
3. æ·»åŠ å­—å¹•æ”¯æŒ
4. å®ç°è§†é¢‘æ’­æ”¾ç»Ÿè®¡åˆ†æ

è¦åœ¨æ•°æ®åº“ä¸­ä¿å­˜è§†é¢‘URLå’Œç¼©ç•¥å›¾URLï¼Œå¯ä»¥åœ¨æ’å…¥æˆ–æ›´æ–°è§†é¢‘æ•°æ®æ—¶ï¼Œå°†è¿™äº›URLä½œä¸ºå­—æ®µå€¼ä¿å­˜ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‰ç«¯é€šè¿‡APIè·å–å¹¶æ­£ç¡®æ˜¾ç¤ºã€‚

---

